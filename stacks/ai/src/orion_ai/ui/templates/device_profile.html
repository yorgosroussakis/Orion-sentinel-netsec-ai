{% extends "base.html" %}

{% block title %}Device Profile - Orion Sentinel{% endblock %}

{% block content %}
<div style="margin-bottom: 1rem;">
    <a href="/devices" style="color: #4a9eff; text-decoration: none;">‚Üê Back to Devices</a>
</div>

<h1 style="margin-bottom: 2rem;">Device Profile</h1>

<!-- Device Info -->
<div class="card">
    <h2>Device Information</h2>
    <table style="width: auto;">
        <tr>
            <th style="width: 200px;">IP Address</th>
            <td><strong>{{ device.ip }}</strong></td>
        </tr>
        <tr>
            <th>Hostname</th>
            <td>{{ device.hostname or 'Unknown' }}</td>
        </tr>
        <tr>
            <th>MAC Address</th>
            <td style="font-family: monospace;">{{ device.mac or 'Unknown' }}</td>
        </tr>
        <tr>
            <th>Device Type</th>
            <td>{{ device.guess_type or 'Unknown' }}</td>
        </tr>
        <tr>
            <th>Owner</th>
            <td>{{ device.owner or 'Unassigned' }}</td>
        </tr>
        <tr>
            <th>Tags</th>
            <td>
                {% if device.tags %}
                    {% for tag in device.tags %}
                    <span class="badge badge-info">{{ tag }}</span>
                    {% endfor %}
                {% else %}
                    <span style="color: #999;">None</span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>First Seen</th>
            <td>{{ device.first_seen.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        </tr>
        <tr>
            <th>Last Seen</th>
            <td>{{ device.last_seen.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        </tr>
    </table>
</div>

<!-- Event Summary -->
<div class="card">
    <h2>Security Events Summary (Last 7 Days)</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <div style="padding: 1rem; background: #f5f5f5; border-radius: 4px;">
            <div style="font-size: 0.875rem; color: #666; margin-bottom: 0.25rem;">Threat Intel Matches</div>
            <div style="font-size: 1.5rem; font-weight: bold; color: #cc0000;">
                {{ event_counts.intel_match }}
            </div>
        </div>
        <div style="padding: 1rem; background: #f5f5f5; border-radius: 4px;">
            <div style="font-size: 0.875rem; color: #666; margin-bottom: 0.25rem;">Anomalies</div>
            <div style="font-size: 1.5rem; font-weight: bold; color: #ff9900;">
                {{ event_counts.device_anomaly }}
            </div>
        </div>
        <div style="padding: 1rem; background: #f5f5f5; border-radius: 4px;">
            <div style="font-size: 0.875rem; color: #666; margin-bottom: 0.25rem;">High-Risk Domains</div>
            <div style="font-size: 1.5rem; font-weight: bold; color: #ff9900;">
                {{ event_counts.domain_risk }}
            </div>
        </div>
    </div>
</div>

<!-- Timeline -->
<div class="card">
    <h2>Activity Timeline</h2>
    {% if timeline %}
    <div style="max-height: 500px; overflow-y: auto;">
        {% for item in timeline %}
        <div style="padding: 1rem; border-left: 3px solid 
                    {% if item.severity == 'CRITICAL' %}#cc0000{% elif item.severity == 'WARNING' %}#ff9900{% else %}#4a9eff{% endif %}; 
                    margin-bottom: 0.5rem; background: #fafafa;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <strong>{{ item.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</strong>
                <span class="badge badge-{% if item.severity == 'CRITICAL' %}critical{% elif item.severity == 'WARNING' %}warning{% else %}info{% endif %}">
                    {{ item.type }}
                </span>
            </div>
            <div>{{ item.description }}</div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p style="color: #666;">No activity recorded</p>
    {% endif %}
</div>

<!-- Recent Events -->
{% if events %}
<div class="card">
    <h2>Recent Events</h2>
    <table>
        <thead>
            <tr>
                <th>Time</th>
                <th>Type</th>
                <th>Severity</th>
                <th>Title</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            {% for event in events %}
            <tr>
                <td>{{ event._timestamp.strftime('%Y-%m-%d %H:%M:%S') if event._timestamp else 'N/A' }}</td>
                <td><span class="badge badge-info">{{ event.event_type }}</span></td>
                <td>
                    <span class="badge badge-{{ event.severity.lower() if event.severity in ['INFO', 'WARNING', 'CRITICAL'] else 'info' }}">
                        {{ event.severity }}
                    </span>
                </td>
                <td>{{ event.title }}</td>
                <td style="max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                    {{ event.description }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}
