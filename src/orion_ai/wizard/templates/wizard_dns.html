<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect to DNS Pi - Orion Sentinel</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è Orion Sentinel</h1>
            <p class="subtitle">Step 1 of 4: Connect to DNS Pi</p>
        </div>

        <div class="content">
            <div class="wizard-step">
                <h2>DNS Pi Configuration</h2>
                
                <p>Orion Sentinel works alongside your DNS Pi to provide comprehensive security monitoring. Enter the details of your DNS Pi (Pi #1) below.</p>

                {% if error %}
                <div class="error-box">
                    <strong>‚ö†Ô∏è Error:</strong> {{ error }}
                </div>
                {% endif %}

                <form method="post" action="/wizard/dns">
                    <div class="form-group">
                        <label for="dns_pi_ip">DNS Pi IP Address:</label>
                        <input 
                            type="text" 
                            id="dns_pi_ip" 
                            name="dns_pi_ip" 
                            value="{{ dns_pi_ip or '192.168.1.10' }}" 
                            required
                            placeholder="e.g., 192.168.1.10"
                            pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$"
                            title="Enter a valid IP address"
                        >
                        <small>The IP address of Pi #1 running Pi-hole/Unbound</small>
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input 
                                type="checkbox" 
                                id="pihole_enabled" 
                                name="pihole_enabled" 
                                {% if pihole_enabled %}checked{% endif %}
                                onchange="togglePiholeToken()"
                            >
                            Enable Pi-hole API Integration
                        </label>
                        <small>Allows automated domain blocking based on threat intelligence</small>
                    </div>

                    <div class="form-group" id="token-group" style="display: {% if pihole_enabled %}block{% else %}none{% endif %};">
                        <label for="pihole_api_token">Pi-hole API Token:</label>
                        <input 
                            type="text" 
                            id="pihole_api_token" 
                            name="pihole_api_token" 
                            value="{{ pihole_api_token or '' }}"
                            placeholder="Enter your Pi-hole API token"
                        >
                        <small>
                            Find this in Pi-hole admin interface: Settings ‚Üí API ‚Üí Show API token<br>
                            Or run: <code>pihole -a -p</code> on Pi #1
                        </small>
                    </div>

                    <div class="info-box">
                        <strong>üí° Tip:</strong> You can skip Pi-hole integration for now and enable it later by editing <code>stacks/ai/.env</code>
                    </div>

                    <div class="button-container">
                        <a href="/wizard/welcome" class="button button-secondary">Back</a>
                        <button type="submit" class="button button-primary">Next: Network Settings</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="footer">
            <p>Step 1 of 4</p>
        </div>
    </div>

    <script>
        function togglePiholeToken() {
            const checkbox = document.getElementById('pihole_enabled');
            const tokenGroup = document.getElementById('token-group');
            const tokenInput = document.getElementById('pihole_api_token');
            
            if (checkbox.checked) {
                tokenGroup.style.display = 'block';
                tokenInput.required = true;
            } else {
                tokenGroup.style.display = 'none';
                tokenInput.required = false;
            }
        }
    </script>
</body>
</html>
